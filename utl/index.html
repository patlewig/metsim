<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="patlewig" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Utilities - metsim</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Utilities";
        var mkdocs_page_input_path = "utl.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> metsim
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../sim/">Simulation (sim)</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Utilities</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#metsim.utl.hcd">hcd</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#metsim.utl.hcd.metsim_hcd_out">metsim_hcd_out</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#metsim.utl.hcd.metsim_metadata_full">metsim_metadata_full</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#metsim.utl.metsim_aggregate">metsim_aggregate</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#metsim.utl.metsim_aggregate.metsim_aggregate_results">metsim_aggregate_results</a>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">metsim</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Utilities</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="utility-utl">Utility (utl)</h1>
<p>Utility functions to aggregate metsim predictions and augment records with addition chemical information from the EPA Cheminformatics Modules (HCD).</p>


<div class="doc doc-object doc-module">



<a id="metsim.utl.hcd"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="metsim.utl.hcd.metsim_hcd_out" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metsim_hcd_out</span><span class="p">(</span><span class="n">smiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">casrn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtxsid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chem_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">likely</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Query function for the Cheminformatics Modules Standardizer API, formerly wrapped within the Hazard Comparison Dashboard (HCD) API. 
 Used to convert an input SMILES string into QSAR-Ready SMILES (hcd_smiles). Returns InChIKey structural identifier as well,
 along with any other chemical identifer metadata if available, and not already given as inputs (e.g., CASRN, DTXSID, Chemical Name).</p>
<p>If SMILES is not known, but DTXSID is known, can instead query on DTXSID to obtain Daylight SMILES from the Comptox Chemicals Dashboard API (CCD API),
 and subsequently query the Standardizer API using the SMILES obtained from the CCD API.</p>
<p>Examples:
         &gt;&gt;&gt; metsim_hcd_out(smiles = "OCCOCCO") 
         {'smiles': 'OCCOCCO','casrn': '111-46-6', 'hcd_smiles': 'OCCOCCO',  'inchikey': 'MTHSVFCYNBDYFN-UHFFFAOYNA-N','dtxsid': 'DTXSID8020462','chem_name': 'Diethylene glycol','likelihood': None}
         &gt;&gt;&gt; metsim_hcd_out(dtxsid = "DTXSID4020402")
         {'smiles': 'CC1=C(N)C=C(N)C=C1', 'casrn': '95-80-7','hcd_smiles': 'CC1C=CC(N)=CC=1N','inchikey': 'VOZKAJLKRJDJLL-UHFFFAOYNA-N','dtxsid': 'DTXSID4020402', 'chem_name': '2,4-Diaminotoluene', 'likelihood': None}
         &gt;&gt;&gt; metsim_hcd_out(smiles = None, dtxsid = None)
         {'smiles': None, 'casrn': None, 'hcd_smiles': None,'inchikey': None, 'dtxsid': None, 'chem_name': None, 'likelihood': None}   </p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>smiles</code></b>
              –
              <div class="doc-md-description">
                <p>Daylight SMILES string </p>
              </div>
            </li>
            <li>
              <b><code>dtxsid</code></b>
              –
              <div class="doc-md-description">
                <p>DSSTox Substance Identifier</p>
              </div>
            </li>
            <li>
              <b><code>chem_name</code></b>
              –
              <div class="doc-md-description">
                <p>Chemical name, whether trade name or IUPAC (optional)</p>
              </div>
            </li>
            <li>
              <b><code>casrn</code></b>
              –
              <div class="doc-md-description">
                <p>Chemical Abstracts Services Registry Number (optional)</p>
              </div>
            </li>
            <li>
              <b><code>inchikey</code></b>
              –
              <div class="doc-md-description">
                <p>International Chemical Identifier Key (InChIKey) (optional)</p>
              </div>
            </li>
            <li>
              <b><code>likely</code></b>
              –
              <div class="doc-md-description">
                <p>If MetSim predictions are obtained from the Chemical Transformation Simulator, can optionally keep the transformation "likelihood" parameter (optional)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
     out_dict: Output dictionary containing all available output data for the given chemical, using the input parameter names as dictionary keys. Includes "hcd" as output dictionary key containing QSAR-Ready version of the input SMILES.</p>

            <details class="quote">
              <summary>Source code in <code>metsim/utl/hcd.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">metsim_hcd_out</span><span class="p">(</span><span class="n">smiles</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                   <span class="n">casrn</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">dtxsid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">chem_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">likely</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query function for the Cheminformatics Modules Standardizer API, formerly wrapped within the Hazard Comparison Dashboard (HCD) API. </span>
<span class="sd">        Used to convert an input SMILES string into QSAR-Ready SMILES (hcd_smiles). Returns InChIKey structural identifier as well,</span>
<span class="sd">        along with any other chemical identifer metadata if available, and not already given as inputs (e.g., CASRN, DTXSID, Chemical Name).</span>

<span class="sd">        If SMILES is not known, but DTXSID is known, can instead query on DTXSID to obtain Daylight SMILES from the Comptox Chemicals Dashboard API (CCD API),</span>
<span class="sd">        and subsequently query the Standardizer API using the SMILES obtained from the CCD API.</span>


<span class="sd">        Examples:</span>
<span class="sd">                &gt;&gt;&gt; metsim_hcd_out(smiles = &quot;OCCOCCO&quot;) </span>
<span class="sd">                {&#39;smiles&#39;: &#39;OCCOCCO&#39;,&#39;casrn&#39;: &#39;111-46-6&#39;, &#39;hcd_smiles&#39;: &#39;OCCOCCO&#39;,  &#39;inchikey&#39;: &#39;MTHSVFCYNBDYFN-UHFFFAOYNA-N&#39;,&#39;dtxsid&#39;: &#39;DTXSID8020462&#39;,&#39;chem_name&#39;: &#39;Diethylene glycol&#39;,&#39;likelihood&#39;: None}</span>
<span class="sd">                &gt;&gt;&gt; metsim_hcd_out(dtxsid = &quot;DTXSID4020402&quot;)</span>
<span class="sd">                {&#39;smiles&#39;: &#39;CC1=C(N)C=C(N)C=C1&#39;, &#39;casrn&#39;: &#39;95-80-7&#39;,&#39;hcd_smiles&#39;: &#39;CC1C=CC(N)=CC=1N&#39;,&#39;inchikey&#39;: &#39;VOZKAJLKRJDJLL-UHFFFAOYNA-N&#39;,&#39;dtxsid&#39;: &#39;DTXSID4020402&#39;, &#39;chem_name&#39;: &#39;2,4-Diaminotoluene&#39;, &#39;likelihood&#39;: None}</span>
<span class="sd">                &gt;&gt;&gt; metsim_hcd_out(smiles = None, dtxsid = None)</span>
<span class="sd">                {&#39;smiles&#39;: None, &#39;casrn&#39;: None, &#39;hcd_smiles&#39;: None,&#39;inchikey&#39;: None, &#39;dtxsid&#39;: None, &#39;chem_name&#39;: None, &#39;likelihood&#39;: None}   </span>

<span class="sd">       Args:</span>
<span class="sd">            smiles: Daylight SMILES string </span>
<span class="sd">            dtxsid: DSSTox Substance Identifier</span>
<span class="sd">            chem_name: Chemical name, whether trade name or IUPAC (optional)</span>
<span class="sd">            casrn: Chemical Abstracts Services Registry Number (optional)</span>
<span class="sd">            inchikey: International Chemical Identifier Key (InChIKey) (optional)</span>
<span class="sd">            likely: If MetSim predictions are obtained from the Chemical Transformation Simulator, can optionally keep the transformation &quot;likelihood&quot; parameter (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            out_dict: Output dictionary containing all available output data for the given chemical, using the input parameter names as dictionary keys. Includes &quot;hcd&quot; as output dictionary key containing QSAR-Ready version of the input SMILES.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ccd_out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">dtxsid</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">smiles</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#get metadata from Comptox Chemicals Dashboard for a given DTXSID (No structure searching atm).</span>
        <span class="n">ccd_url</span> <span class="o">=</span> <span class="s1">&#39;https://comptox.epa.gov/dashboard-api/ccdapp2/chemical-detail/search/by-dsstoxsid?id=&#39;</span><span class="o">+</span><span class="n">dtxsid</span>
        <span class="n">ccd_success</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">try_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">ccd_success</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">try_count</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Attempting query of Comptox Chemicals Dashboard with DTXSID: &#39;</span><span class="o">+</span><span class="n">dtxsid</span><span class="o">+</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
                <span class="n">ccd_out</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">ccd_url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

                <span class="n">ccd_success</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">try_count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1">#Given that this occasionally fails randomly due to timeout errors, </span>
                <span class="c1">#but then works again later, try again after a 1 second pause.</span>
                <span class="c1">#Should work on second attempt.</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;URL Error Occurred, reattempting CCD query in 0.5 seconds.&#39;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">try_count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Query succeeded.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">smiles</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ccd_out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">smiles</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">smiles_url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote_plus</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span> <span class="c1">#URL encode SMILES string.</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ccd_out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ccd_out</span><span class="p">[</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No SMILES given. Using CCD output SMILES.&#39;</span><span class="p">)</span>
            <span class="n">smiles</span> <span class="o">=</span> <span class="n">ccd_out</span><span class="p">[</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span>
            <span class="n">smiles_url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote_plus</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span> <span class="c1">#URL enconde CCD smiles string.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No SMILES given, and no SMILES available from CCD output.&#39;</span><span class="p">)</span>
            <span class="n">smiles_url</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://hcd.rtpnc.epa.gov/api/stdizer?workflow=qsar-ready&amp;smiles=&quot;</span> <span class="c1">#Production environment (current, no VPN needed)</span>

        <span class="k">if</span> <span class="n">smiles_url</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hcd_url</span> <span class="o">=</span> <span class="n">base_url</span><span class="o">+</span><span class="n">smiles_url</span>
            <span class="n">hcd_success</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">try_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">hcd_out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">hcd_success</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">try_count</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Attempting query of Cheminformatics Modules Standardizer with SMILES: &#39;</span><span class="o">+</span><span class="n">smiles</span><span class="o">+</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">hcd_out</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">hcd_url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Query succeeded.&#39;</span><span class="p">)</span>
                    <span class="n">hcd_success</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">try_count</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1">#Given that this occasionally fails randomly due to timeout errors, </span>
                    <span class="c1">#but then works again later, try again after a 0.5 second pause.</span>
                    <span class="c1">#Should work on second attempt.</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;URL Error Occurred, reattempting Cheminformatics Modules query in 0.5 seconds.&#39;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">try_count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hcd_out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;smiles&#39;</span><span class="p">:</span> <span class="n">smiles</span><span class="p">,</span> 
                            <span class="s1">&#39;casrn&#39;</span><span class="p">:</span> <span class="n">casrn</span><span class="p">,</span>
                            <span class="s1">&#39;hcd_smiles&#39;</span><span class="p">:</span> <span class="n">hcd_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;inchikey&#39;</span><span class="p">:</span> <span class="n">hcd_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;inchiKey&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;dtxsid&#39;</span><span class="p">:</span> <span class="n">dtxsid</span><span class="p">,</span>
                            <span class="s1">&#39;chem_name&#39;</span><span class="p">:</span> <span class="n">chem_name</span><span class="p">,</span>
                            <span class="s1">&#39;likelihood&#39;</span><span class="p">:</span> <span class="n">likely</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;dtxsid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;DTXSID&#39;</span> <span class="ow">in</span> <span class="n">hcd_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>
                        <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;dtxsid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hcd_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ccd_out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ccd_out</span><span class="p">[</span><span class="s1">&#39;dsstoxSubstanceId&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;dtxsid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ccd_out</span><span class="p">[</span><span class="s1">&#39;dsstoxSubstanceId&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;casrn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;casrn&#39;</span> <span class="ow">in</span> <span class="n">hcd_out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;casrn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hcd_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;casrn&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ccd_out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ccd_out</span><span class="p">[</span><span class="s1">&#39;casrn&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;casrn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ccd_out</span><span class="p">[</span><span class="s1">&#39;casrn&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;chem_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ccd_out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ccd_out</span><span class="p">[</span><span class="s1">&#39;preferredName&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;chem_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ccd_out</span><span class="p">[</span><span class="s1">&#39;preferredName&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">hcd_out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;chem_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hcd_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ccd_out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ccd_out</span><span class="p">[</span><span class="s1">&#39;inchiKey&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ccd_out</span><span class="p">[</span><span class="s1">&#39;inchiKey&#39;</span><span class="p">]</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;smiles&#39;</span><span class="p">:</span> <span class="n">smiles</span><span class="p">,</span>
                            <span class="s1">&#39;casrn&#39;</span><span class="p">:</span> <span class="n">casrn</span><span class="p">,</span>
                            <span class="s1">&#39;hcd_smiles&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="s1">&#39;inchikey&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="s1">&#39;dtxsid&#39;</span><span class="p">:</span> <span class="n">dtxsid</span><span class="p">,</span>
                            <span class="s1">&#39;chem_name&#39;</span><span class="p">:</span> <span class="n">chem_name</span><span class="p">,</span>
                            <span class="s1">&#39;likelihood&#39;</span><span class="p">:</span> <span class="n">likely</span>
                           <span class="p">}</span>
                <span class="c1">#HCD Returns empty list. Try to supplement with metadata from RDKit.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">smiles_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span>
                    <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">inchi</span><span class="o">.</span><span class="n">MolToInchiKey</span><span class="p">(</span><span class="n">smiles_mol</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RDKit generated InChIKey for SMILES: &#39;</span><span class="p">,</span><span class="n">smiles</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1">#Rarely, BioTransformer makes a bad SMILES string for a metabolite, and RDKit can&#39;t convert it to an InChIKey. Store None</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RDKit failed to generate an inchikey for SMILES: &#39;</span><span class="o">+</span><span class="n">smiles</span><span class="p">)</span>
                    <span class="n">out_dict</span><span class="p">[</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;smiles&#39;</span><span class="p">:</span> <span class="n">smiles</span><span class="p">,</span>
                        <span class="s1">&#39;casrn&#39;</span><span class="p">:</span> <span class="n">casrn</span><span class="p">,</span>
                        <span class="s1">&#39;hcd_smiles&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s1">&#39;inchikey&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s1">&#39;dtxsid&#39;</span><span class="p">:</span> <span class="n">dtxsid</span><span class="p">,</span>
                        <span class="s1">&#39;chem_name&#39;</span><span class="p">:</span> <span class="n">chem_name</span><span class="p">,</span>
                        <span class="s1">&#39;likelihood&#39;</span><span class="p">:</span> <span class="n">likely</span>
                       <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;smiles&#39;</span><span class="p">:</span> <span class="n">smiles</span><span class="p">,</span>
                    <span class="s1">&#39;casrn&#39;</span><span class="p">:</span> <span class="n">casrn</span><span class="p">,</span>
                    <span class="s1">&#39;hcd_smiles&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s1">&#39;inchikey&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s1">&#39;dtxsid&#39;</span><span class="p">:</span> <span class="n">dtxsid</span><span class="p">,</span>
                    <span class="s1">&#39;chem_name&#39;</span><span class="p">:</span> <span class="n">chem_name</span><span class="p">,</span>
                    <span class="s1">&#39;likelihood&#39;</span><span class="p">:</span> <span class="n">likely</span>
                   <span class="p">}</span>
    <span class="k">return</span> <span class="n">out_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="metsim.utl.hcd.metsim_metadata_full" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metsim_metadata_full</span><span class="p">(</span><span class="n">metsim_out</span><span class="o">=</span><span class="p">[],</span> <span class="n">fnam</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metsim_cache</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>MetSim simulators return a hierarchically structured dictionary of predicted precursor and successor SMILES from the given input SMILES. This function
Takes a completed dataset of MetSim predictions in list format, iteratively queries EPA Cheminformatics Modules Standardizer API via the single metsim_hcd_out
utility function call for all precursors and successors in the metsim hierarchy, and returns the list with all available metadata for all the predicted precursors and metabolites.
(i.e., each parent input smiles produces its own dictionary, start from the list of those dictionaries for a full dataset of input parent chemicals).</p>
<p>incorporates temporary caching of the metsim_hcd_out queries to avoid repepetive queries for commonly reoccuring metabolites to save time.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>metsim_out</code></b>
                  (<code>list</code>, default:
                      <code>[]</code>
)
              –
              <div class="doc-md-description">
                <p>list of MetSim hierarchically structured dictionary outputs for each input chemical in the dataset.</p>
              </div>
            </li>
            <li>
              <b><code>fnam</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>the filename you would like to save the output to, ending in .json (e.g., "my_output_data.json"), will save to current working directory if not otherwise specified in fnam.</p>
              </div>
            </li>
            <li>
              <b><code>metsim_cache</code></b>
                  (<code>list</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>list of cached metsim_hcd_out queries.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>metsim/utl/hcd.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">metsim_metadata_full</span><span class="p">(</span><span class="n">metsim_out</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">fnam</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metsim_cache</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MetSim simulators return a hierarchically structured dictionary of predicted precursor and successor SMILES from the given input SMILES. This function</span>
<span class="sd">    Takes a completed dataset of MetSim predictions in list format, iteratively queries EPA Cheminformatics Modules Standardizer API via the single metsim_hcd_out</span>
<span class="sd">    utility function call for all precursors and successors in the metsim hierarchy, and returns the list with all available metadata for all the predicted precursors and metabolites.</span>
<span class="sd">    (i.e., each parent input smiles produces its own dictionary, start from the list of those dictionaries for a full dataset of input parent chemicals).</span>

<span class="sd">    incorporates temporary caching of the metsim_hcd_out queries to avoid repepetive queries for commonly reoccuring metabolites to save time.</span>

<span class="sd">    Args:</span>
<span class="sd">        metsim_out (list): list of MetSim hierarchically structured dictionary outputs for each input chemical in the dataset.</span>
<span class="sd">        fnam (str, optional): the filename you would like to save the output to, ending in .json (e.g., &quot;my_output_data.json&quot;), will save to current working directory if not otherwise specified in fnam.</span>
<span class="sd">        metsim_cache (list, optional): list of cached metsim_hcd_out queries.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">metsim_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">metsim_out</span><span class="p">]</span> <span class="c1">#if a single chemical dataset is given, convert to list of dict</span>
        <span class="k">if</span> <span class="n">metsim_cache</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#Supplement metadata via serial HCD query through individual input chemicals, precursors, successors/metabolites for a full metsim dataset</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">)):</span> <span class="c1"># i = number of input chemicals</span>
                <span class="k">if</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cache_item</span><span class="p">[</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">cache_item</span> <span class="ow">in</span> <span class="n">metsim_cache</span><span class="p">]:</span>
                    <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metsim_hcd_out</span><span class="p">(</span><span class="n">smiles</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">],</span>
                                                            <span class="n">casrn</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;casrn&#39;</span><span class="p">],</span>
                                                            <span class="n">dtxsid</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;dtxsid&#39;</span><span class="p">],</span>
                                                            <span class="n">chem_name</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">])</span>
                    <span class="n">metsim_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input query added to metadata cache...&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input SMILES found in cached results. Inserting into dictionary...&#39;</span><span class="p">)</span>
                    <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metsim_cache</span><span class="p">[[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_cache</span><span class="p">))</span> <span class="k">if</span> <span class="n">metsim_cache</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">])):</span> <span class="c1"># j = number of unique precursors</span>
                    <span class="k">if</span> <span class="s1">&#39;likelihood&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cache_item</span><span class="p">[</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">cache_item</span> <span class="ow">in</span> <span class="n">metsim_cache</span><span class="p">]:</span>
                            <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metsim_hcd_out</span><span class="p">(</span><span class="n">smiles</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">],</span>
                                                                                     <span class="n">casrn</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;casrn&#39;</span><span class="p">],</span>
                                                                                     <span class="n">dtxsid</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;dtxsid&#39;</span><span class="p">],</span>
                                                                                     <span class="n">chem_name</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">],</span>
                                                                                     <span class="n">likely</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;likelihood&#39;</span><span class="p">])</span>
                            <span class="n">metsim_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">])</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precursor query added to metadata cache...&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precursor SMILES found in cached results. Inserting into dictionary...&#39;</span><span class="p">)</span>
                            <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metsim_cache</span><span class="p">[[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_cache</span><span class="p">))</span> <span class="k">if</span> <span class="n">metsim_cache</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cache_item</span><span class="p">[</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">cache_item</span> <span class="ow">in</span> <span class="n">metsim_cache</span><span class="p">]:</span>
                            <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metsim_hcd_out</span><span class="p">(</span><span class="n">smiles</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">],</span>
                                                                                     <span class="n">casrn</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;casrn&#39;</span><span class="p">],</span>
                                                                                     <span class="n">dtxsid</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;dtxsid&#39;</span><span class="p">],</span>
                                                                                     <span class="n">chem_name</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">])</span>
                            <span class="n">metsim_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">])</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precursor query added to metadata cache...&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precursor SMILES found in cached results. Inserting into dictionary...&#39;</span><span class="p">)</span>
                            <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metsim_cache</span><span class="p">[[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_cache</span><span class="p">))</span> <span class="k">if</span> <span class="n">metsim_cache</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">])):</span> <span class="c1"># k = number of metabolites per precursor</span>
                        <span class="k">if</span> <span class="s1">&#39;likelihood&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="k">if</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cache_item</span><span class="p">[</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">cache_item</span> <span class="ow">in</span> <span class="n">metsim_cache</span><span class="p">]:</span>
                                <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metsim_hcd_out</span><span class="p">(</span><span class="n">smiles</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">],</span>
                                                                                                           <span class="n">casrn</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;casrn&#39;</span><span class="p">],</span>
                                                                                                           <span class="n">dtxsid</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;dtxsid&#39;</span><span class="p">],</span>
                                                                                                           <span class="n">chem_name</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">],</span>
                                                                                                           <span class="n">likely</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;likelihood&#39;</span><span class="p">])</span>
                                <span class="n">metsim_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">])</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successor metabolite query added to metadata cache...&#39;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successor metabolite SMILES found in cached results. Inserting into dictionary...&#39;</span><span class="p">)</span>
                                <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metsim_cache</span><span class="p">[[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_cache</span><span class="p">))</span> <span class="k">if</span> <span class="n">metsim_cache</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]]</span> 
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cache_item</span><span class="p">[</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">cache_item</span> <span class="ow">in</span> <span class="n">metsim_cache</span><span class="p">]:</span>
                                <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metsim_hcd_out</span><span class="p">(</span><span class="n">smiles</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">],</span>
                                                                                                           <span class="n">casrn</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;casrn&#39;</span><span class="p">],</span>
                                                                                                           <span class="n">dtxsid</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;dtxsid&#39;</span><span class="p">],</span>
                                                                                                           <span class="n">chem_name</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">])</span>
                                <span class="n">metsim_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">])</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successor metabolite query added to metadata cache...&#39;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successor metabolite SMILES found in cached results. Inserting into dictionary...&#39;</span><span class="p">)</span>
                                <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metsim_cache</span><span class="p">[[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_cache</span><span class="p">))</span> <span class="k">if</span> <span class="n">metsim_cache</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;smiles&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]]</span> 
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39; precursor: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]))</span><span class="o">+</span><span class="s1">&#39; metabolite: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">])))</span>
                <span class="k">if</span> <span class="n">fnam</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">fnam</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metsim_out</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_metsim_metadata_full.json&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metsim_metadata_full</span><span class="p">(</span><span class="n">metsim_out</span> <span class="o">=</span> <span class="n">metsim_out</span><span class="p">,</span> <span class="n">fnam</span> <span class="o">=</span> <span class="n">fnam</span><span class="p">,</span> <span class="n">metsim_cache</span> <span class="o">=</span> <span class="p">[])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span><span class="p">(</span><span class="s1">&#39;Please supply a metsim dataset (list of dictionaries)&#39;</span><span class="p">)</span>
    <span class="c1"># print(metsim_out)</span>
    <span class="k">return</span> <span class="n">metsim_out</span>    
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="metsim.utl.metsim_aggregate"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="metsim.utl.metsim_aggregate.metsim_aggregate_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metsim_aggregate_results</span><span class="p">(</span><span class="n">metsim_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metsim_aggregate_out</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Function to aggregate two or more MetSim hierarchies together into one aggregate hierarchy that specifies how many models predicted each metabolite,
and which models predicted each metabolite.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>metsim_list</code></b>
                  (<code>required</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>processed MetSim hierarchy. Must contain at least SMILES and inchikey metadata. 
                    *note: If unprocessed predictions from a tool get inserted, will raise errors. To process data, 
                    use metsim_metadata_full with your unprocessed predictions to generate the proper input for metsim_list.</p>
              </div>
            </li>
            <li>
              <b><code>metsim_aggregate_out</code></b>
                  (<code>optional</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>If an aggregate set of predictions already exists, and adding another metsim_list to it is desired, 
                             input the existing processed aggregate hierarchy of predictions.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>metsim/utl/metsim_aggregate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">metsim_aggregate_results</span><span class="p">(</span><span class="n">metsim_list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metsim_aggregate_out</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to aggregate two or more MetSim hierarchies together into one aggregate hierarchy that specifies how many models predicted each metabolite,</span>
<span class="sd">    and which models predicted each metabolite.</span>

<span class="sd">    Args:</span>
<span class="sd">        metsim_list (required): processed MetSim hierarchy. Must contain at least SMILES and inchikey metadata. </span>
<span class="sd">                                *note: If unprocessed predictions from a tool get inserted, will raise errors. To process data, </span>
<span class="sd">                                use metsim_metadata_full with your unprocessed predictions to generate the proper input for metsim_list.</span>

<span class="sd">        metsim_aggregate_out (optional): If an aggregate set of predictions already exists, and adding another metsim_list to it is desired, </span>
<span class="sd">                                         input the existing processed aggregate hierarchy of predictions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">metsim_list</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_list</span><span class="p">)):</span>
            <span class="c1">#if the aggregate list is empty, insert the first tool&#39;s output for the first chemical and update the output to reflect which simulator was used, </span>
            <span class="c1">#and that--so far, one tool predicted these metabolites:</span>
            <span class="k">if</span> <span class="n">metsim_aggregate_out</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">metsim_aggregate_out</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">metsim_aggregate_out</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%Hh%Mm%Ss&#39;</span><span class="p">)),</span>
                                            <span class="s1">&#39;software&#39;</span><span class="p">:</span> <span class="s1">&#39;Ensemble Metabolic Predictions&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">],</span>
                                            <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]})</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">])):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">])):</span>
                        <span class="k">if</span> <span class="s1">&#39;toolbox&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="k">if</span> <span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;toolbox_vivo_rat_phase1&#39;</span><span class="p">]</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="s1">&#39;s9&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;toolbox_vitro_rat_phase1&#39;</span><span class="p">]</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;times&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="k">if</span> <span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;times_vivo_rat_phase1_phase2&#39;</span><span class="p">]</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="s1">&#39;s9&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;times_vitro_rat_phase1_phase2&#39;</span><span class="p">]</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;biotransformer&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;biotransformer_human_phase1_phase2&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;admet&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;admet_human_phase1&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;epa&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cts_human_phase1&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;acd&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;acdlabs_percepta&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;smpdb&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;smpdb&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_sources_observed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;jcim&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jcim_literature&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_sources_observed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1">#logical test to see if the ith parent chemical data already exists in the aggregate dictionary.</span>
            <span class="c1">#If not present, insert it into the list:</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">([</span><span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">metsim_aggregate_out</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%Hh%Mm%Ss&#39;</span><span class="p">)),</span>
                                            <span class="s1">&#39;software&#39;</span><span class="p">:</span> <span class="s1">&#39;Aggregate Metabolic Predictions&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">],</span>
                                            <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]})</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lenth of pred dict aggregate &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">])):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">])):</span>
                        <span class="k">if</span> <span class="s1">&#39;toolbox&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="k">if</span> <span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;toolbox_vivo_rat_phase1&#39;</span><span class="p">]</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="s1">&#39;s9&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;toolbox_vitro_rat_phase1&#39;</span><span class="p">]</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;times&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="k">if</span> <span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;times_vivo_rat_phase1_phase2&#39;</span><span class="p">]</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="s1">&#39;s9&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;times_vitro_rat_phase1_phase2&#39;</span><span class="p">]</span>
                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;biotransformer&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;biotransformer_human_phase1_phase2&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;admet&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;admet_human_phase1&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;epa&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cts_human_phase1&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;acd&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;acdlabs_percepta&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;smpdb&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;smpdb&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_sources_observed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="s1">&#39;jcim&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jcim_literature&#39;</span><span class="p">]</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_sources_observed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1">#All parent chemicals accounted for by at least one tool. Check to see if the tool from &quot;metsim_list&quot; is represented in the output of the aggregate pathway. If not, add those outputs:</span>
            <span class="c1">#Check precursors first. If precursor isn&#39;t present in the existing precursors for that parent, add it and its successors.</span>
            <span class="c1">#If precursors are all accounted for, add successors for each tool, append &quot;predicted_by&quot; list if another tool also predicts those successors, and +1 &quot;num_tools_predicted&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">))])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">idx_in</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">))</span> <span class="k">if</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">][</span><span class="s1">&#39;chem_name&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">input_precursors_inchi2d</span> <span class="o">=</span> <span class="p">[</span><span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]))]</span>
                    <span class="n">aggregate_precursors_inchi2d</span> <span class="o">=</span> <span class="p">[</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]))]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">input_precursors_inchi2d</span><span class="p">)):</span>
                        <span class="c1">#For the ith parent, if the jth output precursor from a tool&#39;s predictions isn&#39;t present in the existing precursors for the parent, append the jth precursor and its successors.</span>
                        <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">input_precursors_inchi2d</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">aggregate_precursors_inchi2d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aggregate_precursors_inchi2d</span><span class="p">))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="c1">#Iterate over successors for the newly appended output to reflect the tool predicted by, and number of tools predicted.</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">])):</span>
                                <span class="k">if</span> <span class="s1">&#39;toolbox&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                    <span class="k">if</span> <span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                        <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;toolbox_vivo_rat_phase1&#39;</span><span class="p">]</span>
                                        <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                    <span class="k">if</span> <span class="s1">&#39;s9&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                        <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;toolbox_vitro_rat_phase1&#39;</span><span class="p">]</span>
                                        <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="s1">&#39;times&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                    <span class="k">if</span> <span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                        <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;times_vivo_rat_phase1_phase2&#39;</span><span class="p">]</span>
                                        <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                    <span class="k">if</span> <span class="s1">&#39;s9&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                        <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;times_vitro_rat_phase1_phase2&#39;</span><span class="p">]</span>
                                        <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="s1">&#39;biotransformer&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;biotransformer_human_phase1_phase2&#39;</span><span class="p">]</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="s1">&#39;admet&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;admet_human_phase1&#39;</span><span class="p">]</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="s1">&#39;epa&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cts_human_phase1&#39;</span><span class="p">]</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="s1">&#39;acd&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;acdlabs_percepta&#39;</span><span class="p">]</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="s1">&#39;smpdb&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;smpdb&#39;</span><span class="p">]</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_sources_observed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="s1">&#39;jcim&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jcim_literature&#39;</span><span class="p">]</span>
                                    <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;num_sources_observed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="c1">#Else, for the ith parent, if the jth output precursor from a tool&#39;s predictions already exists in the list of precursors,</span>
                        <span class="c1">#Check that the output from that tool isn&#39;t already inventoried in the aggregate</span>
                        <span class="c1">#If not, incorporate its successors to that output, or add to the number of tools predicted and predicted by lists.</span>
                        <span class="k">elif</span> <span class="nb">sum</span><span class="p">([</span><span class="n">input_precursors_inchi2d</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">aggregate_precursors_inchi2d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aggregate_precursors_inchi2d</span><span class="p">))])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="c1">#Passing this logical test says that the jth precursor is already in the aggregate list for the ith parent chemical.</span>
                            <span class="c1">#In case the length of the output lists is different due to appending new precursors into the aggregate list, find the index corresponding to the jth precursor for the tool in the aggregate precursor list:</span>
                            <span class="n">idx_con</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;precursor&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">])):</span>
                                <span class="k">if</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="c1">#If the kth successor of the jth precursor is not present in the aggregate list for that same precursor, add it into the successor list:</span>
                                    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;successor appended for &#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;th precursor&#39;</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="s1">&#39;toolbox&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                            <span class="k">if</span> <span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;toolbox_vivo_rat_phase1&#39;</span><span class="p">]</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                            <span class="k">if</span> <span class="s1">&#39;s9&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;toolbox_vitro_rat_phase1&#39;</span><span class="p">]</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;times&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                            <span class="k">if</span> <span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;times_vivo_rat_phase1_phase2&#39;</span><span class="p">]</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                            <span class="k">if</span> <span class="s1">&#39;s9&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;times_vitro_rat_phase1_phase2&#39;</span><span class="p">]</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;biotransformer&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;biotransformer_human_phase1_phase2&#39;</span><span class="p">]</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;admet&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;admet_human_phase1&#39;</span><span class="p">]</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;epa&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cts_human_phase1&#39;</span><span class="p">]</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;acd&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;acdlabs_percepta&#39;</span><span class="p">]</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;smpdb&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;smpdb&#39;</span><span class="p">]</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;num_sources_observed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;jcim&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jcim_literature&#39;</span><span class="p">]</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;num_sources_observed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="c1">#Successor is present in the successor list. Find its index in aggregate successors. Check which model corresponds to this prediction. </span>
                                        <span class="c1">#if it&#39;s different from those inventoried currently, add it to the predicted by list, and increment number of models predicted</span>
                                        <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">]</span>
                                        <span class="n">idx_suc_con</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;metabolite&#39;</span><span class="p">][</span><span class="s1">&#39;inchikey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="k">if</span> <span class="s1">&#39;toolbox&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                            <span class="k">if</span> <span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;toolbox_vivo_rat_phase1&#39;</span><span class="p">)</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                            <span class="k">if</span> <span class="s1">&#39;s9&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="s1">&#39;vitro&#39;</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;toolbox_vitro_rat_phase1&#39;</span><span class="p">)</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;times&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                                            <span class="k">if</span> <span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="s1">&#39;vivo&#39;</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;times_vivo_rat_phase1_phase2&#39;</span><span class="p">)</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                            <span class="k">if</span> <span class="s1">&#39;s9&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="s1">&#39;vitro&#39;</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;times_vitro_rat_phase1_phase2&#39;</span><span class="p">)</span>
                                                <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;biotransformer&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="s1">&#39;biotransformer&#39;</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;biotransformer_human_phase1_phase2&#39;</span><span class="p">)</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;admet&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="s1">&#39;admet&#39;</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;admet_human_phase1&#39;</span><span class="p">)</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;epa&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="s1">&#39;epa&#39;</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;cts_human_phase1&#39;</span><span class="p">)</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;acd&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="s1">&#39;acd&#39;</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;predicted_by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;acdlabs_percepta&#39;</span><span class="p">)</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;num_models_predicted&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;smpdb&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="s1">&#39;smpdb&#39;</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;smpdb&#39;</span><span class="p">)</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;num_sources_observed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="s1">&#39;jcim&#39;</span> <span class="ow">in</span> <span class="n">metsim_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;software&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="s1">&#39;jcim&#39;</span> <span class="ow">in</span> <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]))])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;observed_in&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;jcim_literature&#39;</span><span class="p">)</span>
                                            <span class="n">metsim_aggregate_out</span><span class="p">[</span><span class="n">idx_in</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">][</span><span class="n">idx_con</span><span class="p">][</span><span class="s1">&#39;successors&#39;</span><span class="p">][</span><span class="n">idx_suc_con</span><span class="p">][</span><span class="s1">&#39;num_sources_observed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please provide a list of MetSim predictions.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metsim_aggregate_out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../sim/" class="btn btn-neutral float-left" title="Simulation (sim)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../sim/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
